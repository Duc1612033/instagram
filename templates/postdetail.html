{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<head>
    <style>
        .post__buttons {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.reactions {
    display: inline-flex;
    align-items: center;
    gap: 8px; /* Kho·∫£ng c√°ch gi·ªØa c√°c icon */
}

#reaction-menu {
    position: absolute;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 8px;
    display: flex;
    gap: 4px;
}







          /* ƒê·∫∑t k√≠ch th∆∞·ªõc c·ªë ƒë·ªãnh cho ·∫£nh b√¨nh lu·∫≠n */
    .comment-image {
        width: 100%;
        max-height: 300px; /* ƒê·∫∑t chi·ªÅu cao t·ªëi ƒëa cho ·∫£nh */
        object-fit: cover; /* Gi√∫p ·∫£nh kh√¥ng b·ªã bi·∫øn d·∫°ng */
        margin-bottom: 10px; /* Kho·∫£ng c√°ch gi·ªØa ·∫£nh v√† c√°c n√∫t */
    }

    /* ƒê·∫£m b·∫£o c√°c n√∫t "S·ª≠a" v√† "X√≥a" n·∫±m b√™n d∆∞·ªõi ·∫£nh */
    .comment-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-start;
        margin-top: 10px;
    }

    /* CƒÉn ch·ªânh c√°c n√∫t "S·ª≠a", "X√≥a" ·ªü cu·ªëi */
    .comment-container {
        position: relative;
        padding-bottom: 40px; 
    }
    
/* L√πi c√°c b√¨nh lu·∫≠n tr·∫£ l·ªùi */
.ml-4 {
    margin-left: 20px; /* ƒêi·ªÅu ch·ªânh kho·∫£ng c√°ch l√πi */
}

/* Thay ƒë·ªïi ki·ªÉu cho c√°c n√∫t th√†nh ch·ªØ */
button {
    background: none; /* B·ªè n·ªÅn */
    border: none; /* B·ªè vi·ªÅn */
    color: blue; /* M√†u ch·ªØ */
    text-decoration: underline; /* G·∫°ch ch√¢n */
    cursor: pointer; /* Ch·ªâ con tr·ªè khi hover */
}

button:hover {
    color: darkblue; /* M√†u khi hover */
}

/* ·∫®n c√°c n√∫t "S·ª≠a" v√† "L∆∞u" */
button[id^="edit-button"], button[id^="save-comment"] {
    display: inline; /* Hi·ªÉn th·ªã nh∆∞ ch·ªØ */
}

/* ƒê·ªãnh d·∫°ng cho n√∫t "X√≥a" */
form button[type="submit"] {
    background: none; /* B·ªè n·ªÅn */
    border: none; /* B·ªè vi·ªÅn */
    color: red; /* M√†u ch·ªØ ƒë·ªè */
    text-decoration: underline; /* G·∫°ch ch√¢n */
    cursor: pointer; /* Ch·ªâ con tr·ªè khi hover */
}

form button[type="submit"]:hover {
    color: darkred; /* M√†u khi hover */
}

/* ƒê·ªãnh d·∫°ng cho n√∫t "Reply" */
button[onclick*="toggleReplyForm"] {
    background: none; /* B·ªè n·ªÅn */
    border: none; /* B·ªè vi·ªÅn */
    color: blue; /* M√†u ch·ªØ */
    text-decoration: underline; /* G·∫°ch ch√¢n */
}







.post__more-options {
  position: relative;
  cursor: pointer;
}

/* ·∫®n tooltip m·∫∑c ƒë·ªãnh */
.tooltip-text {
  display: none;
  position: absolute;
  top: 100%; /* Hi·ªÉn th·ªã tooltip d∆∞·ªõi n√∫t ba ch·∫•m */
  left: 50%;
  transform: translateX(-50%);
  background-color: white;
  border: 1px solid #ccc;
  padding: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  z-index: 1;
}

/* Hi·ªÉn th·ªã tooltip khi di chu·ªôt v√†o n√∫t ba ch·∫•m */
.post__more-options:hover .tooltip-text {
  display: block;
}

.tooltip-text button {
  display: block;
  background: none;
  border: none;
  color: #000;
  padding: 4px 8px;
  cursor: pointer;
  width: 100%;
  text-align: left;
}

.tooltip-text button:hover {
  background-color: #f0f0f0;
}

        

.date {
    font-size: 11px
}

.comment-text {
    font-size: 12px
}

.fs-12 {
    font-size: 12px
}

.shadow-none {
    box-shadow: none
}

.name {
    color: #007bff
}

.cursor:hover {
    color: blue
}

.cursor {
    cursor: pointer
}

.textarea {
    resize: none
}
    </style>
</head>
    <main class="main-container">
        <section class="content-container">
            <div class="contendt">


                <div class="posts">

                    <article class="post">
                        <div class="post__header">
                            <div class="post__profile">
                                <a href="{% url 'profile' post.user %}" class="post__avatar">
                                    <img src="{{ post.user.profile.image.url }}" alt="User Picture">
                                </a>
                                <a href="{% url 'profile' post.user %}" class="post__user">@{{ post.user.username }}</a>
                            </div>
                            {% if request.user == post.user %}
                            <div class="post__privacy">
                                <form action="{% url 'update_privacy' post.id %}" method="post">
                                    {% csrf_token %}
                                    <select name="privacy" onchange="this.form.submit()">
                                        <option value="public" {% if post.privacy == 'public' %}selected{% endif %}>Public</option>
                                        <option value="friends" {% if post.privacy == 'friends' %}selected{% endif %}>Friends</option>
                                        <option value="only_me" {% if post.privacy == 'only_me' %}selected{% endif %}>Only Me</option>
                                    </select>
                                </form>
                            </div>
                            {% endif %}
                        
                            

                            
                           
<div class="post__more-options">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="6.5" cy="11.5" r="1.5" fill="var(--text-dark)"/>
        <circle cx="12" cy="11.5" r="1.5" fill="var(--text-dark)"/>
        <circle cx="17.5" cy="11.5" r="1.5" fill="var(--text-dark)"/>
    </svg>
    <div class="tooltip-text">
        <form action="{% url 'update_post' post.id %}" method="get">
            <button type="submit">C·∫≠p nh·∫≠t</button>
        </form>
        <form method="POST" action="{% url 'delete_post' post_id=post.id %}?app_name=profile&page_name=profile">
            {% csrf_token %}
            <button type="submit">X√≥a </button>
        </form>
        
    </div>
    
</div>
                            
                        </div>

                        <div class="post__content">
                            <div class="post__medias">
                                <svg width="500" height="500" viewBox="0 0 500 500" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="500" height="500" fill="black"/>
                                    <image x="0" y="0" width="500" height="500" preserveAspectRatio="xMidYMid slice" href="{{ post.picture.url }}"/>
                                  </svg><!--                                <img class="post__media" src="{% static 'assets1/insta-clone.png' %}" alt="Post Content">--><!--                                <img class="post__media" src="{% static 'assets1/insta-clone.png' %}" alt="Post Content">-->
                            </div>
                        </div>
                      <!-- React main button -->


<!-- Hi·ªÉn th·ªã t·ªïng s·ªë l∆∞·ª£t react -->
<div class="reaction-count">
    T·ªïng b√†y t·ªè c·∫£m x√∫c: <span id="total-reactions">{{ total_reactions }}</span>
</div>
<script>
    // H√†m hi·ªÉn th·ªã/·∫©n menu c·∫£m x√∫c
    function toggleReactionsMenu() {
        const reactionMenu = document.getElementById('reaction-menu');
        reactionMenu.style.display = reactionMenu.style.display === 'none' ? 'block' : 'none';
    }

    // H√†m x·ª≠ l√Ω khi ng∆∞·ªùi d√πng ch·ªçn c·∫£m x√∫c
    function reactToPost(postId, emoji) {
        fetch(`/${postId}/react/${emoji}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            }
        }).then(response => response.json())
          .then(data => {
              // C·∫≠p nh·∫≠t bi·ªÉu t∆∞·ª£ng ch√≠nh
              const mainReaction = document.getElementById('main-reaction');
              mainReaction.textContent = emojiToIcon(emoji);

              // ·∫®n menu c·∫£m x√∫c
              document.getElementById('reaction-menu').style.display = 'none';

              // C·∫≠p nh·∫≠t t·ªïng s·ªë l∆∞·ª£t react
              const totalReactionsSpan = document.getElementById('total-reactions');
              totalReactionsSpan.textContent = data.total_reactions;
          });
    }

    // H√†m ƒë·ªïi emoji th√†nh bi·ªÉu t∆∞·ª£ng (icon)
    function emojiToIcon(emoji) {
        const emojiIcons = {
            'like': 'üëç',
            'love': '‚ù§Ô∏è',
            'laugh': 'üòÇ',
            'wow': 'üòÆ',
            'sad': 'üò¢',
            'angry': 'üò°',
        };
        return emojiIcons[emoji] || 'üëç'; // M·∫∑c ƒë·ªãnh l√† 'üëç'
    }
</script>


                        <div class="post__footer">
                            <div class="post__buttons">
                                <div class="reactions">
                                    <!-- Bi·ªÉu t∆∞·ª£ng ch√≠nh (·∫©n danh s√°ch khi ch∆∞a b·∫•m) -->
                                    <a href="javascript:void(0)" id="main-reaction" onclick="toggleReactionsMenu()">üëç</a>
                                
                                    <!-- Danh s√°ch c√°c bi·ªÉu t∆∞·ª£ng (·∫©n m·∫∑c ƒë·ªãnh) -->
                                    <div id="reaction-menu" style="display: none;">
                                        <a href="javascript:void(0)" onclick="reactToPost('{{ post.id }}', 'like')">üëç</a>
                                        <a href="javascript:void(0)" onclick="reactToPost('{{ post.id }}', 'love')">‚ù§Ô∏è</a>
                                        <a href="javascript:void(0)" onclick="reactToPost('{{ post.id }}', 'laugh')">üòÇ</a>
                                        <a href="javascript:void(0)" onclick="reactToPost('{{ post.id }}', 'wow')">üòÆ</a>
                                        <a href="javascript:void(0)" onclick="reactToPost('{{ post.id }}', 'sad')">üò¢</a>
                                        <a href="javascript:void(0)" onclick="reactToPost('{{ post.id }}', 'angry')">üò°</a>
                                    </div>
                                </div>
                                
                                <button class="post__button" onclick="toggleComments()">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M21.2959 20.8165L20.2351 16.8602C20.1743 16.6385 20.2047 16.3994 20.309 16.1907C21.2351 14.3342 21.5438 12.117 20.9742 9.80402C20.2003 6.67374 17.757 4.16081 14.6354 3.33042C13.7833 3.10869 12.9442 3 12.1312 3C6.29665 3 1.74035 8.47365 3.31418 14.5647C4.04458 17.3819 7.05314 20.2992 9.88344 20.9861C10.6486 21.173 11.4008 21.26 12.1312 21.26C13.7006 21.26 15.1701 20.8557 16.4614 20.1601C16.6049 20.0818 16.7657 20.0383 16.9222 20.0383C17.0005 20.0383 17.0787 20.047 17.157 20.0688L21.009 21.0991C21.0307 21.1035 21.0525 21.1078 21.0699 21.1078C21.2177 21.1078 21.3351 20.9687 21.2959 20.8165ZM19.0178 17.1863L19.6178 19.4253L17.4831 18.8558C17.3005 18.8079 17.1135 18.7819 16.9222 18.7819C16.557 18.7819 16.1875 18.8775 15.8571 19.0558C14.6963 19.6818 13.4441 19.9992 12.1312 19.9992C11.4834 19.9992 10.8269 19.9166 10.1791 19.7601C7.78354 19.1775 5.14453 16.6037 4.53586 14.2473C3.90111 11.7865 4.40109 9.26057 5.90536 7.31719C7.40964 5.3738 9.6791 4.26081 12.1312 4.26081C12.8529 4.26081 13.5876 4.35646 14.3137 4.5521C16.9961 5.26511 19.0786 7.39544 19.7525 10.1084C20.2264 12.0213 20.0308 13.9299 19.183 15.6298C18.9395 16.1168 18.8787 16.6689 19.0178 17.1863Z" fill="var(--text-dark)" stroke="var(--text-dark)" stroke-width="0.7"/>
                                    </svg>
                                </button>
                                <button class="post__button">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M22.8555 3.44542C22.6978 3.16703 22.3962 3 22.0714 3L2.91369 3.01392C2.52859 3.01392 2.19453 3.25055 2.05997 3.60781C1.96254 3.86764 1.98574 4.14603 2.11565 4.37338C2.16669 4.45689 2.23165 4.53577 2.31052 4.60537L9.69243 10.9712L11.4927 20.5338C11.5623 20.9096 11.8499 21.188 12.2304 21.2483C12.6062 21.3086 12.9774 21.1323 13.1723 20.8029L22.8509 4.35018C23.0179 4.06715 23.0179 3.72381 22.8555 3.44542ZM4.21748 4.39194H19.8164L10.4255 9.75089L4.21748 4.39194ZM12.6248 18.9841L11.1122 10.948L20.5171 5.58436L12.6248 18.9841Z" fill="var(--text-dark)" stroke="var(--text-dark)" stroke-width="0.3"/>
                                    </svg>
                                </button>

                                <div class="post__indicators"></div>

                                <button class="post__button post__button--align-right">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M19.875 2H4.125C3.50625 2 3 2.44939 3 3.00481V22.4648C3 23.0202 3.36563 23.1616 3.82125 22.7728L11.5444 16.1986C11.7244 16.0471 12.0225 16.0471 12.2025 16.1936L20.1731 22.7879C20.6287 23.1666 21 23.0202 21 22.4648V3.00481C21 2.44939 20.4994 2 19.875 2ZM19.3125 20.0209L13.3444 15.0827C12.9281 14.7394 12.405 14.5677 11.8763 14.5677C11.3363 14.5677 10.8019 14.7444 10.3856 15.0979L4.6875 19.9502V3.51479H19.3125V20.0209Z" fill="var(--text-dark)" stroke="var(--text-dark)" stroke-width="0.7"/>
                                    </svg>
                                </button>
                            </div>

                                <div class="post__description">
                                    <span>
                                        <a class="post__name--underline" href="#"><b>@{{post.user.username}}</b></a>
                                        {{post.caption}}

                                    </span>
                                </div>
                                <p style="font-size: 13px;">{% for tag in post.tags.all %}
                                    <a href="{{ tag.get_absolute_url }}" style="text-decoration: none;">
                                        #{{ tag }}
                                    </a>
                                    {% endfor %}
                                </p>
                                <span class="post__date-time">{{post.posted}}</span>

                                <div class="container mt-1">
                                    <div class="d-flex justify-content-right row">
                                        <div class="col-md-8 col-lg-8">
                                            <div class="d-flex flex-column comment-section">
                                                <form method="POST" action="{% url 'add_comment' post.id %}" enctype="multipart/form-data">
                                                    {% csrf_token %}
                                                   
                                                   
                                                    <div class="bg-light p-2">
                                                        <div class="d-flex flex-row align-items-start">
                                                            <img class="rounded-circle" src="{{ request.user.profile.image.url }}" width="30" height="30" alt="User Profile">
                                                            <input type="text" name="body" class="form-control ms-2" placeholder="Nh·∫≠p b√¨nh lu·∫≠n..."> <!-- √î nh·∫≠p li·ªáu -->
                                                        </div>
                                                        <input type="file" name="image" accept="image/*" class="form-control-file mt-2"> <!-- Th√™m tr∆∞·ªùng ch·ªçn ·∫£nh -->
                                                        <div class="mt-2 text-right">
                                                            <button class="btn btn-primary btn-sm shadow-none" type="submit">Post comment</button>
                                                        </div>
                                                      </div>
                                                      
                                                      <style>
                                                        
                                                        .bg-light {
                                                            background-color: #f8f9fa; /* M√†u n·ªÅn s√°ng */
                                                            border-radius: 8px; /* Bo g√≥c cho √¥ */
                                                            padding: 10px; /* Kho·∫£ng c√°ch b√™n trong */
                                                            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* ƒê·ªï b√≥ng nh·∫π */
                                                        }
                                                        .form-control {
                                                            border-radius: 20px; /* Bo g√≥c cho √¥ nh·∫≠p li·ªáu */
                                                            border: 1px solid #ced4da; /* ƒê∆∞·ªùng vi·ªÅn */
                                                            padding: 8px; /* Kho·∫£ng c√°ch b√™n trong */
                                                            transition: border-color 0.3s; /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi */
                                                            height: 38px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh */
                                                        }
                                                        .form-control:focus {
                                                            border-color: #007BFF; /* ƒê·ªïi m√†u vi·ªÅn khi focus */
                                                            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); /* Hi·ªáu ·ª©ng b√≥ng */
                                                            outline: none; /* X√≥a vi·ªÅn ngo√†i */
                                                        }
                                                        .form-control-file {
                                                            border-radius: 20px; /* Bo g√≥c cho √¥ ch·ªçn file */
                                                            padding: 5px; /* Kho·∫£ng c√°ch b√™n trong */
                                                            margin-top: 5px; /* Kho·∫£ng c√°ch gi·ªØa c√°c √¥ */
                                                        }
                                                        .btn {
                                                            border-radius: 20px; /* Bo g√≥c cho n√∫t */
                                                            padding: 6px 12px; /* K√≠ch th∆∞·ªõc n√∫t */
                                                        }
                                                      </style>
                                                </form>
                                                <!-- Form th√™m b√¨nh lu·∫≠n -->
                                        
                                                {% for comment in comments %}
                                                <div class="bg-white p-2 mb-2">
                                                    <!-- Th√¥ng tin ng∆∞·ªùi d√πng -->
                                                    <div class="d-flex flex-row user-info">
                                                        <img class="rounded-circle" src="{{ comment.user.profile.image.url }}" width="30" height="30" alt="User profile image">
                                                        <a href="{% url 'profile' comment.user %}" style="text-decoration: none;">
                                                            <div class="d-flex flex-column justify-content-start ml-2">
                                                                <span class="d-block font-weight-bold name">{{ comment.user.profile.first_name }} {{ comment.user.profile.last_name }}</span>
                                                                <span class="date text-black-50">{{ comment.date }}</span>
                                                            </div>
                                                        </a>
                                                    </div>
                                            
                                                    <!-- N·ªôi dung b√¨nh lu·∫≠n -->
                                                    <div class="mt-2">
                                                        <p id="comment-{{ comment.id }}" class="comment-text">{{ comment.body }}</p>
                                                         <!-- Hi·ªÉn th·ªã ·∫£nh n·∫øu c√≥ -->
                                                         {% if comment.image %}
                                                         <img src="{{ comment.image.url }}" alt="Comment image" class="comment-image">
                                                         {% endif %}
                                                         {% if comment.user == request.user or comment.post.user == request.user %}
<form action="{% url 'delete_comment' comment.id %}" method="POST" style="display: inline;">
    {% csrf_token %}
    <button type="submit">X√≥a</button>
</form>
{% endif %}                                           
                                                        <!-- Tr∆∞·ªùng ch·ªânh s·ª≠a b√¨nh lu·∫≠n -->
                                                        <textarea id="edit-comment-text-{{ comment.id }}" style="display: none;">{{ comment.body }}</textarea>
                                            
                                                        <!-- N√∫t ch·ªânh s·ª≠a v√† l∆∞u -->
                                                        {% if comment.user == request.user %}
                                                            <button id="edit-button-{{ comment.id }}" onclick="editComment('{{ comment.id }}'); return false;">S·ª≠a</button>
                                                            <button id="save-comment-{{ comment.id }}" onclick="saveComment('{{ comment.id }}'); return false;" style="display: none;">L∆∞u</button>
                                             <!-- Hi·ªÉn th·ªã th√¥ng tin ƒë·ªÉ ki·ªÉm tra quy·ªÅn s·ªü h·ªØu -->
                                                        {% endif %}
                                            
                                                        <!-- N√∫t hi·ªÉn th·ªã form tr·∫£ l·ªùi -->
                                                        <button onclick="toggleReplyForm('{{ comment.id }}'); return false;">Reply</button>
                                            
                                                        <!-- Form tr·∫£ l·ªùi, ban ƒë·∫ßu ·∫©n -->
                                                        <form enctype="multipart/form-data" id="reply-form-{{ comment.id }}" action="{% url 'reply_comment' comment.id %}" method="POST" style="display: none;">
                                                            {% csrf_token %}
                                                            <textarea name="body" placeholder="Tr·∫£ l·ªùi b√¨nh lu·∫≠n..." rows="2" class="form-control"></textarea>
                                                            <input type="file" name="image" accept="image/*">  <!-- Th√™m tr∆∞·ªùng ch·ªçn ·∫£nh -->
                                                            <button type="submit" class="btn btn-primary mt-2">G·ª≠i</button>
                                                        </form>
                                                         <!-- Hi·ªÉn th·ªã n√∫t Like cho b√¨nh lu·∫≠n g·ªëc -->
                                                         <div class="like-section mt-2">
                                                            <span class="like-count">{{ comment.like_count }} Likes</span>
                                                            <button class="like-btn" data-comment-id="{{ comment.id }}" data-is-liked="{% if request.user in comment.likes.all %}true{% else %}false{% endif %}">
                                                                {% if request.user in comment.likes.all %}Unlike{% else %}Like{% endif %}
                                                            </button>
                                                        </div>
                                                        <!-- Hi·ªÉn th·ªã c√°c c√¢u tr·∫£ l·ªùi c·ªßa b√¨nh lu·∫≠n -->
                                                        {% if comment.replies.all %}
                                                            <div class="ml-4 mt-2">
                                                                {% for reply in comment.replies.all %}
                                                                    <div class="bg-white p-2 mb-2">
                                                                        <!-- Th√¥ng tin ng∆∞·ªùi d√πng cho c√¢u tr·∫£ l·ªùi -->
                                                                        <div class="d-flex flex-row user-info">
                                                                            <img class="rounded-circle" src="{{ reply.user.profile.image.url }}" width="30" height="30" alt="User  profile image">
                                                                            <a href="{% url 'profile' reply.user %}" style="text-decoration: none;">
                                                                                <div class="d-flex flex-column justify-content-start ml-2">
                                                                                    <span class="d-block font-weight-bold name">{{ reply.user.profile.first_name }} {{ reply.user.profile.last_name }}</span>
                                                                                    <span class="date text-black-50">{{ reply.date }}</span>
                                                                                </div>
                                                                            </a>
                                                                        </div>
                                            
                                                                        <div id="reply-{{ reply.id }}">
                                                                            <!-- N·ªôi dung c√¢u tr·∫£ l·ªùi -->
                                                                            <p id="reply-body-{{ reply.id }}">{{ reply.body }}</p>
                                                                        
                                                                            <!-- Hi·ªÉn th·ªã ·∫£nh n·∫øu Reply c√≥ -->
                                                                            {% if reply.image %}
                                                                            <img src="{{ reply.image.url }}" alt="Reply image" class="reply-image">
                                                                            {% endif %}
                                                                        
                                                                            <!-- Tr∆∞·ªùng ch·ªânh s·ª≠a c√¢u tr·∫£ l·ªùi -->
                                                                            <textarea id="edit-reply-text-{{ reply.id }}" style="display: none;">{{ reply.body }}</textarea>
                                                                        
                                                                            <!-- N√∫t ch·ªânh s·ª≠a v√† l∆∞u -->
                                                                            {% if reply.user == request.user %}
                                                                            <button id="edit-reply-button-{{ reply.id }}" onclick="editReply('{{ reply.id }}'); return false;">S·ª≠a</button>
                                                                            <button id="save-reply-{{ reply.id }}" onclick="saveReply('{{ reply.id }}'); return false;" style="display: none;">L∆∞u</button>
                                                                            {% endif %}
                                                                        
                                                                            <!-- N√∫t x√≥a (ch·ªâ cho ch·ªß s·ªü h·ªØu ho·∫∑c admin c·ªßa b√†i vi·∫øt) -->
                                                                            {% if reply.user == request.user or reply.comment.post.user == request.user %}
                                                                            <form action="{% url 'delete_reply' reply.id %}" method="POST" style="display: inline;">
                                                                                {% csrf_token %}
                                                                                <button type="submit">X√≥a</button>
                                                                            </form>
                                                                            {% endif %}
                                                                        </div>
                                                                        
                                                                            
                                                                    
                                                                        <script>
                                                                            // Ch·ª©c nƒÉng hi·ªÉn th·ªã tr∆∞·ªùng ch·ªânh s·ª≠a khi b·∫•m n√∫t "S·ª≠a" cho c√¢u tr·∫£ l·ªùi
                                                                // Ch·ª©c nƒÉng hi·ªÉn th·ªã tr∆∞·ªùng ch·ªânh s·ª≠a khi b·∫•m n√∫t "S·ª≠a" cho reply
    function editReply(replyId) {
    const replyText = document.getElementById(`reply-body-${replyId}`);
    const editTextArea = document.getElementById(`edit-reply-text-${replyId}`);
    const saveButton = document.getElementById(`save-reply-${replyId}`);
    const editButton = document.getElementById(`edit-reply-button-${replyId}`);

    // L·∫•y n·ªôi dung t·ª´ vƒÉn b·∫£n hi·ªán t·∫°i ƒë·ªÉ ƒë·ªìng b·ªô v·ªõi textarea
    editTextArea.value = replyText.textContent.trim();

    // ·∫®n vƒÉn b·∫£n v√† n√∫t s·ª≠a, hi·ªÉn th·ªã textarea v√† n√∫t l∆∞u
    replyText.style.display = 'none';
    editTextArea.style.display = 'block';
    saveButton.style.display = 'inline-block';
    editButton.style.display = 'none';
}

                                                                // L∆∞u c√¢u tr·∫£ l·ªùi sau khi ch·ªânh s·ª≠a
                                                                function saveReply(replyId) {
    const editTextArea = document.getElementById(`edit-reply-text-${replyId}`);
    const newBody = editTextArea.value;  // L·∫•y n·ªôi dung m·ªõi

    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;  // L·∫•y CSRF token

    fetch("{% url 'edit_reply' reply.id %}".replace("reply.id", replyId), { // Thay reply.id b·∫±ng ID th·ª±c t·∫ø
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken,
        },
        body: JSON.stringify({ body: newBody }),
    })
        .then(response => {
            if (!response.ok) throw new Error(`L·ªói k·∫øt n·ªëi: ${response.status}`);
            return response.json();
        })
        .then(data => {
            if (data.message) {
                // C·∫≠p nh·∫≠t n·ªôi dung m·ªõi v√†o DOM
                const replyText = document.getElementById(`reply-body-${replyId}`);
                replyText.textContent = newBody;

                // ƒê·∫∑t l·∫°i tr·∫°ng th√°i hi·ªÉn th·ªã sau khi s·ª≠a
                replyText.style.display = 'block'; // Hi·ªÉn th·ªã n·ªôi dung s·ª≠a ƒë·ªïi
                editTextArea.style.display = 'none'; // ·∫®n textarea ch·ªânh s·ª≠a
                document.getElementById(`save-reply-${replyId}`).style.display = 'none'; // ·∫®n n√∫t l∆∞u
                document.getElementById(`edit-reply-button-${replyId}`).style.display = 'inline-block'; // Hi·ªÉn th·ªã n√∫t s·ª≠a

                console.log("N·ªôi dung ƒë√£ ƒë∆∞·ª£c s·ª≠a:", newBody);
            } else if (data.error) {
                alert(data.error);  // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu server tr·∫£ v·ªÅ l·ªói
            }
        })
        .catch(error => {
            console.error("L·ªói k·∫øt n·ªëi:", error);
            alert("L·ªói k·∫øt n·ªëi, vui l√≤ng th·ª≠ l·∫°i.");
        });
}



                                                                
                                                                // H·ªßy ch·ªânh s·ª≠a c√¢u tr·∫£ l·ªùi v√† hi·ªÉn th·ªã l·∫°i vƒÉn b·∫£n
                                                                function cancelEditReply(replyId) {
                                                                    const replyText = document.getElementById(`reply-${replyId}`);
                                                                    const editTextArea = document.getElementById(`edit-reply-text-${replyId}`);
                                                                    const saveButton = document.getElementById(`save-reply-${replyId}`);
                                                                    const editButton = document.getElementById(`edit-reply-button-${replyId}`);
                                                                
                                                                    // Hi·ªÉn th·ªã l·∫°i vƒÉn b·∫£n c√¢u tr·∫£ l·ªùi v√† ·∫©n tr∆∞·ªùng ch·ªânh s·ª≠a
                                                                    replyText.style.display = 'block';
                                                                    editTextArea.style.display = 'none';
                                                                    saveButton.style.display = 'none';
                                                                    editButton.style.display = 'inline-block';
                                                                }
                                                                
                                                                    const replyText = document.getElementById(`reply-${replyId}`);
                                                                    const editTextArea = document.getElementById(`edit-reply-text-${replyId}`);
                                                                    const saveButton = document.getElementById(`save-reply-${replyId}`);
                                                                    const editButton = document.getElementById(`edit-reply-button-${replyId}`);
                                                                
                                                                    // Hi·ªÉn th·ªã l·∫°i vƒÉn b·∫£n c√¢u tr·∫£ l·ªùi v√† ·∫©n tr∆∞·ªùng ch·ªânh s·ª≠a
                                                                    replyText.style.display = 'block';
                                                                    editTextArea.style.display = 'none';
                                                                    saveButton.style.display = 'none';
                                                                    editButton.style.display = 'inline-block';
                                                                
                                                                
                                                                // Ch·ª©c nƒÉng x√≥a c√¢u tr·∫£ l·ªùi
                                                                function deleteReply(replyId) {
                                                                    fetch(`/reply/delete/${replyId}/`, {
                                                                        method: 'POST',
                                                                        headers: {
                                                                            'X-CSRFToken': '{{ csrf_token }}',  // CSRF token ƒë·ªÉ b·∫£o m·∫≠t
                                                                            'Content-Type': 'application/json'  // ƒê·ªãnh d·∫°ng y√™u c·∫ßu l√† JSON
                                                                        }
                                                                    })
                                                                    .then(response => response.json())
                                                                    .then(data => {
                                                                        if (data.error) {
                                                                            alert(data.error);  // N·∫øu c√≥ l·ªói, hi·ªÉn th·ªã th√¥ng b√°o l·ªói
                                                                        } else if (data.status === 'success') {
                                                                            // N·∫øu x√≥a th√†nh c√¥ng, t√¨m v√† x√≥a reply kh·ªèi DOM
                                                                            const replyElement = document.getElementById(`reply-${replyId}`);
                                                                            if (replyElement) {
                                                                                replyElement.remove();  // Lo·∫°i b·ªè reply kh·ªèi giao di·ªán
                                                                            }
                                                                        }
                                                                    })
                                                                    .catch(error => console.error('Error:', error));  // In l·ªói n·∫øu c√≥ l·ªói trong qu√° tr√¨nh fetch
                                                                }
                                                                
                                                                        </script>
                                                                          <!-- N√∫t Like cho c√¢u tr·∫£ l·ªùi -->
                                                                          <div class="like-section mt-2">
                                                                            <span class="like-count">{{ comment.like_count }} Likes</span>
                                                                            <button class="like-btn" data-comment-id="{{ comment.id }}" data-is-liked="{% if request.user in comment.likes.all %}true{% else %}false{% endif %}">
                                                                                {% if request.user in comment.likes.all %}Unlike{% else %}Like{% endif %}
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                {% endfor %}
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                    
                                                </div>
                                            {% endfor %}
                                               
                                        <script>
                                                function toggleComments() {
                                                var commentSection = document.getElementById("comment-section");
                                                if (commentSection.style.display === "none") {
                                                    commentSection.style.display = "block";
                                                } else {
                                                    commentSection.style.display = "none";
                                                }
                                            }
                                            
                                            </script>
                                                                                      
                                            <script>
                                                function toggleReplyForm(commentId) {
                                                    var form = document.getElementById("reply-form-" + commentId);
                                                    if (form.style.display === "none") {
                                                        form.style.display = "block";
                                                    } else {
                                                        form.style.display = "none";
                                                    }
                                                }
                                            </script>   
                                            
                                            
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </article>

                </div>
            </div>
        </section>
    </main>

{% endblock content %}